name: CI

on:
  push:
  pull_request:
    branches: ["main"]
    types: [opened, synchronize]
jobs:
  quality:
    name: Quality, Build & Test
    runs-on: ubuntu-latest
    permissions:
      contents: read

    steps:
      # 1Ô∏è‚É£ Checkout repository
      - name: Checkout repo
        uses: actions/checkout@v6
        with:
          persist-credentials: false

      # 2Ô∏è‚É£ Setup Bun
      - name: Setup Bun
        uses: oven-sh/setup-bun@v2
        with:
          bun-version: latest

      # 3Ô∏è‚É£ Install dependencies
      - name: Install dependencies
        run: bun install

      # 4Ô∏è‚É£ Setup Turbo cache
      - name: Setup Turbo cache
        uses: actions/cache@v5
        with:
          path: .turbo
          key: ${{ runner.os }}-turbo-${{ github.sha }}
          restore-keys: |
            ${{ runner.os }}-turbo-

      # 5Ô∏è‚É£ Setup Biome
      - name: Setup Biome
        uses: biomejs/setup-biome@v2
        with:
          version: latest

      # 6Ô∏è‚É£ Run Biome CI
      - name: Run Biome checks
        run: bun run check:ci

      # 7Ô∏è‚É£ Check types
      - name: Check TypeScript types
        run: bun run check-types

      # 8Ô∏è‚É£ Clean dist
      - name: Clean dist folder
        run: bun run clean

      # 9Ô∏è‚É£ Build TypeScript & bundle
      - name: Build library
        run: bun run build

      # üîü Run tests
      - name: Run tests
        run: bun test
